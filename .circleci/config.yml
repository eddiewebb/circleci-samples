version: 2.1

executors:

  latest:
    docker:
    - image: cimg/base:stable
    - image: docker.nexus.namer.circleci-fieldeng.com/eddie/talktome
      environment:
        LISTEN_HOST: 0.0.0.0
        LISTEN_PORT: 4000
        TARGET_HOST_PORTS: localhost:5000,localhost:3000
    - image: docker.nexus.namer.circleci-fieldeng.com/eddie/talktome
      environment:
        LISTEN_HOST: 0.0.0.0
        LISTEN_PORT: 5000
        TARGET_HOST_PORTS: localhost:4000,localhost:3000

jobs:
  only:
    executor: latest
    steps:
      - run: |
          nc -l 0.0.0.0 3000 &
          sleep 5
          nc -w 2 -v localhost 5000 || echo "nope"
          echo "why doesnt this run.."
          nc -w 2 -v localhost 4000 || echo "nope"
          sleep 5
          kill %1
          
          




  
workflows:
  test-deploy:
    jobs:
      - only:
          name: do stuff