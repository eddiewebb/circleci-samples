version: 2.1

orbs:
  queue: eddiewebb/queue@3.3.3

executors:
  ecr:
    docker:
    - image: public.ecr.aws/docker/library/bash:devel-alpine3.21
  latest:
    docker:
    - image: cimg/base:stable


jobs:
  only:
    parameters:
      image:
        type: executor

    executor: <<parameters.image>>
    steps:
      - run: |
          echo "this can not run concurrently"
          sleep 30
          
          


workflows:
  pass:
    jobs:
      - only:
          name: <<matrix.image>>-run-concurent
          serial-group: group-a<<matrix.image>>
          matrix:
            
            parameters:
              image: [latest]
      - only:
          name: <<matrix.image>>-serial-a
          requires: [<<matrix.image>>-run-concurent]
          serial-group: group-a<<matrix.image>>
          matrix:
            parameters:
              image: [latest]
      - only:
          name: <<matrix.image>>-serial-b
          serial-group: group-a<<matrix.image>>
          requires: [<<matrix.image>>-serial-a]
          matrix:
            parameters:
              image: [latest]
              
  # fail:
  #   jobs:
  #     - only:
  #        context: [only_one_workflow]
        

