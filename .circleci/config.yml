version: 2.1

parameters:
  orb_version:
    default: "latest"
    type: string

orbs:
  common: eddiewebb/common_tasks@dev:pull/2-67cd95d4af5bf8c96a15e8adb1803af71213a8a9

workflows:
  basic:
    jobs:
      - common/common_task:
          task-name: demo-task
          pre-steps:

            - run: |
                if [ -z "$CIRCLE_PULL_REQUEST" ]; then              
                  echo -e "No open pull request. Could be initial commit, give author a monent to initiate and abort otherwise"
                  sleep 30
                  curl https://circleci.com/api/v1.1/project/gh/${CIRCLE_PROJECT_USERNAME}/{$CIRCLE_PROJECT_REPONAME}/${CIRCLE_BUILD_NUM}?circle-token=${CIRCLE_TOKEN} > /tmp/buildinfo.json
                  jq '.pull_requests' /tmp/buildinfo.json || $(echo "no PR"; circleci step halt)                 
                fi
                