version: 2.1

executors:
  php:
    docker:
      - image: cimg/php:7.4

jobs:
  prepare-dependencies:
    executor: php
    resource_class: small
    steps:
      - checkout
      - run: |
          mkdir tmp
          touch tmp/foo
          touch baz
          touch biz
      - persist_to_workspace:
          root: .
          paths:
              - .
  phpunit:
    executor: php
    #parallelism: 80
    resource_class: small
    steps:
      - attach_workspace:
          at: .
      - run:
          name: Start PHP Server
          command: ls -la
      - run: touch newfile
      - persist_to_workspace:
          root: new
          paths:
              - newfile

  coverage:
    executor: php
    resource_class: small
    steps:
      - attach_workspace:
          at: .
          name: Start PHP Server
          command: ls -la
  
workflows:
  version: 2
  test-deploy:
    jobs:
      - prepare-dependencies
      - phpunit:
          requires:
            - prepare-dependencies
      - coverage:
          requires:
            - prepare-dependencies
            